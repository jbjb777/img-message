<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì´ë¯¸ì§€ì— ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°</title>
  <link rel="icon" type="image/svg+xml" href="./logo.png">

  <style>
    :root {
      --bg: #121212;
      --card-bg: #1e1e1e;
      --border: #333;
      --text: #e0e0e0;
      --text-sub: #aaaaaa;
      --accent: #3663FF;
      --accent-hover: #4d7aff;
      --danger: #ff4444;
      --radius: 16px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: 0 8px 32px rgba(0,0,0,0.45);
      padding: 40px 32px;
      width: 100%;
      max-width: 520px;
      backdrop-filter: blur(10px);
      position: relative;
    }

    /* ê²½ê³  í† ìŠ¤íŠ¸ */
    .toast {
      position: absolute;
      top: -80px;
      right: 24px;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 14px 20px;
      color: white;
      font-size: 0.95rem;
      font-weight: 500;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
      pointer-events: none;
      z-index: 100;
      white-space: nowrap;
    }

    .toast.show {
      top: 24px;
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    h1 {
      font-size: 2.1rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 0.4rem;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: var(--text-sub);
      text-align: center;
      font-size: 1rem;
      margin-bottom: 2.4rem;
    }

    .step-dots {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 2rem;
    }

    .step-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #444;
      transition: all 0.4s ease;
    }

    .step-dot.active {
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(54,99,255,0.25);
      transform: scale(1.3);
    }

    .upload-zone {
      border: 2px dashed #444;
      border-radius: 16px;
      padding: 32px 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.25s ease;
      background: rgba(255,255,255,0.02);
      margin-bottom: 1.5rem;
      position: relative;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .upload-zone:hover,
    .upload-zone.active {
      border-color: var(--accent);
      background: rgba(54,99,255,0.08);
    }

    .upload-zone.dragover {
      border-color: var(--accent-hover);
      background: rgba(54,99,255,0.15);
    }

    .upload-preview {
      max-width: 100%;
      max-height: 140px;
      border-radius: 10px;
      object-fit: contain;
      margin-bottom: 12px;
      display: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    }

    .upload-text {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      transition: opacity 0.3s;
    }

    .has-preview .upload-text {
      opacity: 0.6;
      font-size: 0.95rem;
    }

    .upload-subtext {
      color: var(--text-sub);
      font-size: 0.88rem;
    }

    .filename-display {
      margin-top: 0.8rem;
      color: var(--accent);
      font-weight: 500;
      font-size: 0.95rem;
      word-break: break-all;
    }

    .btn {
      width: 100%;
      padding: 16px;
      font-size: 1.05rem;
      font-weight: 600;
      color: white;
      background: var(--accent);
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.25s ease;
      margin-top: 1rem;
    }

    .btn:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(54,99,255,0.35);
    }

    .result-area {
      margin-top: 2rem;
      padding: 24px;
      background: rgba(0,0,0,0.25);
      border-radius: 12px;
      border-left: 4px solid var(--accent);
      min-height: 140px;
      line-height: 1.6;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .error {
      border-left-color: var(--danger);
      color: #ffaaaa;
    }

    .back-btn {
      background: #2c2c2c;
      color: #ccc;
      margin-top: 2rem;
    }

    .back-btn:hover {
      background: #383838;
    }

    @media (max-width: 520px) {
      .container {
        padding: 32px 20px;
      }
      .toast {
        right: 16px;
        left: 16px;
        right: auto;
        width: calc(100% - 32px);
        text-align: center;
      }
    }
  </style>
</head>
<body>

<div class="container" id="uploadContainer">
  <div class="toast" id="toastWarning">
    PNG íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
  </div>

  <h1>í…ìŠ¤íŠ¸ë¥¼ ìˆ¨ê¸´ ì´ë¯¸ì§€ì— ìˆëŠ” ë©”ì‹œì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤</h1>
  <div class="subtitle">png ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤</div>

  <div class="step-dots">
    <div class="step-dot active"></div>
    <div class="step-dot"></div>
  </div>

  <div class="upload-zone" id="dropZone">
    <img id="previewImg" class="upload-preview" alt="ë¯¸ë¦¬ë³´ê¸°"/>
    <div class="upload-text">ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ì˜¬ë ¤ì£¼ì„¸ìš”</div>
    <div class="upload-subtext">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•´ì„œ ì—…ë¡œë“œ</div>
    <div class="filename-display" id="fileNameDisplay"></div>
  </div>

  <input type="file" id="imageInput" accept="image/png" style="display:none;">

  <button class="btn" id="extractBtn">ë©”ì‹œì§€ ì¶”ì¶œí•˜ê¸°</button>
</div>


<div class="container" id="resultContainer" style="display:none;">
  <h1>ì¶”ì¶œ ê²°ê³¼</h1>
  <div class="subtitle">ì´ë¯¸ì§€ì—ì„œ ë°œê²¬ëœ ë©”ì‹œì§€ì…ë‹ˆë‹¤</div>

  <div class="step-dots">
    <div class="step-dot"></div>
    <div class="step-dot active"></div>
  </div>

  <div class="result-area" id="resultArea">
    ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤...
  </div>

  <button class="btn back-btn" onclick="showUploadPage()">ë‹¤ë¥¸ ì´ë¯¸ì§€ë¡œ ë‹¤ì‹œ ì‹œë„</button>
</div>

<script>
const SECRET_MARK = "<<<SECRET_MARK>>>";

const uploadContainer = document.getElementById("uploadContainer");
const resultContainer = document.getElementById("resultContainer");
const resultArea = document.getElementById("resultArea");
const fileInput = document.getElementById("imageInput");
const dropZone = document.getElementById("dropZone");
const previewImg = document.getElementById("previewImg");
const fileNameDisplay = document.getElementById("fileNameDisplay");
const extractBtn = document.getElementById("extractBtn");
const toast = document.getElementById("toastWarning");

let currentFile = null;

function showToast() {
  toast.classList.add("show");
  setTimeout(() => {
    toast.classList.remove("show");
  }, 3200);
}

function showUploadPage() {
  resultContainer.style.display = "none";
  uploadContainer.style.display = "block";
  resultArea.textContent = "";
  resultArea.className = "result-area";
  currentFile = null;
  previewImg.style.display = "none";
  fileNameDisplay.textContent = "";
  fileInput.value = "";
  dropZone.classList.remove("has-preview");
}

function showResultPage() {
  uploadContainer.style.display = "none";
  resultContainer.style.display = "block";
}

async function extractMessage() {
  if (!currentFile) {
    alert("ë¨¼ì € ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
    return;
  }

  showResultPage();
  resultArea.textContent = "ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...";

  try {
    const buffer = await currentFile.arrayBuffer();
    const decoder = new TextDecoder("utf-8");
    const text = decoder.decode(buffer);

    const startIndex = text.indexOf(SECRET_MARK);
    if (startIndex === -1) {
      resultArea.textContent = "ìˆ¨ê²¨ì§„ ë©”ì‹œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ ğŸ˜”";
      resultArea.className = "result-area error";
      return;
    }

    const message = text.slice(startIndex + SECRET_MARK.length).trim();
    resultArea.innerHTML = `<strong>ë°œê²¬ëœ ë©”ì‹œì§€:</strong><br><br>${message.replace(/\n/g, '<br>')}`;
  } catch (err) {
    resultArea.textContent = "ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n" + err.message;
    resultArea.className = "result-area error";
  }
}

// íŒŒì¼ ì„ íƒ ì‹œ ì²˜ë¦¬
function handleFileSelect(file) {
  if (!file) return;

  // PNGë§Œ í—ˆìš©
  if (file.type !== "image/png") {
    showToast();
    fileInput.value = "";
    return;
  }

  currentFile = file;
  fileNameDisplay.textContent = file.name;

  const reader = new FileReader();
  reader.onload = (e) => {
    previewImg.src = e.target.result;
    previewImg.style.display = "block";
    dropZone.classList.add("has-preview");
  };
  reader.readAsDataURL(file);
}

// ì´ë²¤íŠ¸ ì—°ê²°
extractBtn.onclick = extractMessage;

dropZone.onclick = () => fileInput.click();

fileInput.onchange = (e) => {
  if (e.target.files?.[0]) {
    handleFileSelect(e.target.files[0]);
  }
};

dropZone.ondragover = (e) => {
  e.preventDefault();
  dropZone.classList.add("dragover");
};

dropZone.ondragleave = () => {
  dropZone.classList.remove("dragover");
};

dropZone.ondrop = (e) => {
  e.preventDefault();
  dropZone.classList.remove("dragover");

  if (e.dataTransfer.files?.[0]) {
    handleFileSelect(e.dataTransfer.files[0]);
  }
};
</script>
</body>
</html>
